<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>å¸å®‰LaunchPoolæ–°å¸æŒ–çŸ¿è®¡ç®—å™¨</title>
    <style>
        body {
            margin: 0;
            padding: 40px 20px;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #f4f6f8;
            color: #333;
        }

        h1 {
            text-align: center;
            font-size: 34px;
            margin-bottom: 40px;
            color: #2c3e50;
            font-weight: 600;
        }

        .bnb-price {
            text-align: center;
            font-size: 20px;
            color: #0d47a1;
            margin-bottom: 40px;
        }

        .form-container {
            max-width: 500px;
            margin: 0 auto 40px auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 16px;
            color: #34495e;
        }

        .form-group input {
            width: 100%;
            padding: 14px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 16px;
            background-color: #ffffff;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            border-color: #3498db;
            outline: none;
        }

        .ratio-group {
            display: flex;
            gap: 20px;
        }

        .ratio-group > div {
            flex: 1;
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 30px;
        }

        .btn {
            background-color: #3498db;
            color: #ffffff;
            border: none;
            padding: 16px 40px;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        #manual_price_section {
            text-align: center;
            margin: 20px auto;
        }

        #manual_price_section p {
            font-size: 16px;
            color: #856404;
            margin-bottom: 10px;
        }

        #manual_price_section input {
            width: 100%;
            max-width: 500px;
            padding: 14px;
            border: 1px solid #ffeeba;
            background-color: #fff8e1;
            border-radius: 4px;
            font-size: 16px;
        }

        /* ç»“æœæ¨¡å—æ ·å¼ */
        .results {
            max-width: 500px;
            margin: 60px auto 0 auto;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            padding: 30px;
        }

        .results h2 {
            text-align: center;
            font-size: 26px;
            font-weight: 600;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .result-item {
            display: flex;
            align-items: flex-start;
            padding: 20px 0;
        }

        .result-item:not(:last-child) {
            border-bottom: 1px solid #ecf0f1;
        }

        .result-icon {
            font-size: 24px;
            margin-right: 20px;
        }

        .result-content {
            flex: 1;
        }

        .result-title {
            font-size: 16px;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }

        .result-value {
            font-size: 20px;
            font-weight: bold;
            color: #e74c3c;
        }

        @media (max-width: 600px) {
            body {
                padding: 20px;
            }

            h1 {
                font-size: 28px;
                margin-bottom: 30px;
            }

            .form-group input,
            #manual_price_section input {
                font-size: 14px;
                padding: 12px;
            }

            .btn {
                font-size: 16px;
                padding: 14px 30px;
            }

            .results {
                padding: 20px;
            }

            .results h2 {
                font-size: 20px;
                margin-bottom: 20px;
            }

            .result-item {
                padding: 15px 0;
            }

            .result-icon {
                font-size: 20px;
                margin-right: 15px;
            }

            .result-title {
                font-size: 14px;
            }

            .result-value {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <h1>å¸å®‰LaunchPoolæ–°å¸æŒ–çŸ¿è®¡ç®—å™¨</h1>
    <div class="bnb-price" id="bnb_price_display">æ­£åœ¨è·å– BNB ä»·æ ¼...</div>

    <div class="form-container">
        <div class="form-group">
            <label for="total_newcoin">Launchpool åˆ†é…çš„æ€» NEWCOIN æ•°é‡</label>
            <input type="number" id="total_newcoin" placeholder="ä¾‹å¦‚: 4800000" min="0">
        </div>
        <div class="form-group">
            <label for="days">æŒ–çŸ¿å‘¨æœŸå¤©æ•°</label>
            <input type="number" id="days" placeholder="ä¾‹å¦‚: 2" min="1">
        </div>
        <div class="form-group">
            <label for="fdusd_apy">FDUSD æ± å¹´åŒ–æ”¶ç›Šç‡ (å¦‚5% è¾“å…¥0.05)</label>
            <input type="number" step="0.0001" id="fdusd_apy" placeholder="ä¾‹å¦‚: 1.2" min="0" value="1.2">
        </div>
        <div class="form-group">
            <label for="total_fdusd_staked">FDUSD æ± æ€»è´¨æŠ¼é‡</label>
            <input type="number" id="total_fdusd_staked" placeholder="ä¾‹å¦‚: 1107945920" min="0" value="1107945920">
        </div>
        <div class="form-group">
            <label for="total_bnb_staked">BNB æ± æ€»è´¨æŠ¼é‡</label>
            <input type="number" id="total_bnb_staked" placeholder="ä¾‹å¦‚: 17663825" min="0" value="17663825">
        </div>
        <div class="form-group ratio-group">
            <div>
                <label for="fdusd_ratio">FDUSD åˆ†é…æ¯”ä¾‹ (%)</label>
                <input type="number" id="fdusd_ratio" placeholder="ä¾‹å¦‚: 15" min="0" max="100" value="15">
            </div>
            <div>
                <label for="bnb_ratio">BNB åˆ†é…æ¯”ä¾‹ (%)</label>
                <input type="number" id="bnb_ratio" placeholder="ä¾‹å¦‚: 85" min="0" max="100" value="85">
            </div>
        </div>

        <!-- æ–°å¢ç”¨æˆ·æŠ•å…¥é‡‘é¢è¾“å…¥ -->
        <div class="form-group">
            <label for="user_fdusd_invest">æŠ•å…¥çš„ FDUSD æ•°é‡ (é»˜è®¤0)</label>
            <input type="number" id="user_fdusd_invest" placeholder="ä¾‹å¦‚: 10000" min="0" value="0">
        </div>
        <div class="form-group">
            <label for="user_bnb_invest">æŠ•å…¥çš„ BNB æ•°é‡ (é»˜è®¤0)</label>
            <input type="number" id="user_bnb_invest" placeholder="ä¾‹å¦‚: 10" min="0" value="0">
        </div>

        <div id="manual_price_section" style="display: none;">
            <p>æ— æ³•è·å– BNB ä»·æ ¼ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥:</p>
            <input type="number" id="manual_bnb_price" placeholder="ä¾‹å¦‚: 720.93" min="0" step="0.01">
        </div>

        <div class="btn-wrapper">
            <button class="btn" onclick="calculate()">è®¡ç®—</button>
        </div>
    </div>

    <div class="results" id="results" style="display: none;">
        <h2>è®¡ç®—ç»“æœ</h2>

        <div class="result-item">
            <div class="result-icon">ğŸ’</div>
            <div class="result-content">
                <div class="result-title">å…±è·å¾—çš„ NEWCOIN æ•°é‡</div>
                <div class="result-value" id="line_total_newcoin">-</div>
            </div>
        </div>

        <div class="result-item">
            <div class="result-icon">ğŸ’°</div>
            <div class="result-content">
                <div class="result-title">NEWCOIN ä»·æ ¼ (FDUSDè®¡)</div>
                <div class="result-value" id="line_newcoin_price">-</div>
            </div>
        </div>

        <div class="result-item">
            <div class="result-icon">ğŸ’°</div>
            <div class="result-content">
                <div class="result-title">NEWCOIN ä»·å€¼ (FDUSDè®¡)</div>
                <div class="result-value" id="line_total_value">-</div>
            </div>
        </div>

        <div class="result-item">
            <div class="result-icon">ğŸ“ˆ</div>
            <div class="result-content">
                <div class="result-title">æŠ•å…¥10,000 FDUSDåœ¨FDUSDæ± æ”¶ç›Š</div>
                <div class="result-value" id="line_fdusd_profit">-</div>
            </div>
        </div>

        <div class="result-item">
            <div class="result-icon">ğŸ“Š</div>
            <div class="result-content">
                <div class="result-title">æŠ•å…¥10,000 FDUSDåœ¨BNBæ± æ”¶ç›Š</div>
                <div class="result-value" id="line_bnb_profit">-</div>
            </div>
        </div>
    </div>

    <script>
        let globalBNBPrice = null;

        async function fetchBNBPrice() {
            try {
                let response = await fetch('https://www.suitechsui.red/api/v3/ticker/price?symbol=BNBFDUSD');
                let data = await response.json();
                if (data.symbol === "BNBFDUSD" && data.price) {
                    let bnbPrice = parseFloat(data.price);
                    document.getElementById('bnb_price_display').innerText = `å½“å‰ BNB ä»·æ ¼: ${bnbPrice} FDUSD`;
                    return bnbPrice;
                } else {
                    document.getElementById('bnb_price_display').innerText = `æ— æ³•è·å– BNB ä»·æ ¼`;
                    document.getElementById('manual_price_section').style.display = 'block';
                    return null;
                }
            } catch (error) {
                console.error('è·å– BNB ä»·æ ¼å¤±è´¥:', error);
                document.getElementById('bnb_price_display').innerText = `æ— æ³•è·å– BNB ä»·æ ¼`;
                document.getElementById('manual_price_section').style.display = 'block';
                return null;
            }
        }

        window.onload = async function() {
            globalBNBPrice = await fetchBNBPrice();
        }

        function calculate_newcoin_price(total_newcoin, days, fdusd_apy, total_fdusd_staked, bnb_ratio, fdusd_ratio) {
            let fdusd_newcoin = total_newcoin * (fdusd_ratio / 100);
            let newcoin_per_fdusd_total = fdusd_newcoin / total_fdusd_staked;
            let newcoin_per_fdusd_per_year = (newcoin_per_fdusd_total / days) * 365;
            let p_newcoin = fdusd_apy / newcoin_per_fdusd_per_year;
            return { p_newcoin, fdusd_newcoin, bnb_newcoin: total_newcoin * (bnb_ratio / 100) };
        }

        function calculate() {
            let total_newcoin = parseFloat(document.getElementById('total_newcoin').value);
            let days = parseInt(document.getElementById('days').value);
            let fdusd_apy = parseFloat(document.getElementById('fdusd_apy').value);
            let total_fdusd_staked = parseFloat(document.getElementById('total_fdusd_staked').value);
            let total_bnb_staked = parseFloat(document.getElementById('total_bnb_staked').value);
            let fdusd_ratio = parseFloat(document.getElementById('fdusd_ratio').value);
            let bnb_ratio = parseFloat(document.getElementById('bnb_ratio').value);

            let user_fdusd_invest = parseFloat(document.getElementById('user_fdusd_invest').value);
            let user_bnb_invest = parseFloat(document.getElementById('user_bnb_invest').value);

            let bnb_price = globalBNBPrice;

            if (document.getElementById('manual_price_section').style.display === 'block') {
                let manual_bnb_price = parseFloat(document.getElementById('manual_bnb_price').value);
                if (isNaN(manual_bnb_price) || manual_bnb_price <= 0) {
                    alert('è¯·ç¡®ä¿æ‰‹åŠ¨è¾“å…¥çš„ BNB ä»·æ ¼æ˜¯æœ‰æ•ˆçš„æ­£æ•°ã€‚');
                    return;
                }
                bnb_price = manual_bnb_price;
            }

            if (isNaN(total_newcoin) || isNaN(days) || isNaN(fdusd_apy) || isNaN(total_fdusd_staked) ||
                isNaN(total_bnb_staked) || isNaN(fdusd_ratio) || isNaN(bnb_ratio) ||
                isNaN(user_fdusd_invest) || isNaN(user_bnb_invest) ||
                total_newcoin <= 0 || days <= 0 || fdusd_apy <= 0 || total_fdusd_staked <= 0 ||
                total_bnb_staked <= 0 || fdusd_ratio < 0 || bnb_ratio < 0 ||
                (fdusd_ratio + bnb_ratio) !== 100 ||
                user_fdusd_invest < 0 || user_bnb_invest < 0
            ) {
                alert('è¯·ç¡®ä¿è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼ï¼Œå¹¶ä¸”åˆ†é…æ¯”ä¾‹ä¹‹å’Œä¸º100%ã€‚');
                return;
            }

            if (!bnb_price) {
                alert('BNB ä»·æ ¼æœªè·å–æˆåŠŸï¼Œè¯·ç¨åå†è¯•æ‰‹åŠ¨è¾“å…¥ä»·æ ¼ã€‚');
                return;
            }

            // è®¡ç®—æ¯ä¸ªæ± çš„NEWCOINåˆ†é…æ€»é‡
            let fdusd_pool_total = total_newcoin * (fdusd_ratio / 100);
            let bnb_pool_total = total_newcoin * (bnb_ratio / 100);

            // è®¡ç®—ç”¨æˆ·å®é™…æŠ•èµ„çš„æ”¶ç›Š
            let user_fdusd_newcoin = user_fdusd_invest > 0 ? 
                (user_fdusd_invest / total_fdusd_staked) * fdusd_pool_total : 0;
            
            let user_bnb_newcoin = user_bnb_invest > 0 ? 
                (user_bnb_invest / total_bnb_staked) * bnb_pool_total : 0;

            // ç”¨æˆ·æ€»è·å¾—çš„NEWCOIN
            let total_newcoin_gained = user_fdusd_newcoin + user_bnb_newcoin;

            // è®¡ç®—NEWCOINä»·æ ¼
            let { p_newcoin } = calculate_newcoin_price(total_newcoin, days, fdusd_apy, total_fdusd_staked, bnb_ratio, fdusd_ratio);

            // è®¡ç®—æ€»ä»·å€¼
            let total_value = total_newcoin_gained * p_newcoin;

            // æ¨¡æ‹Ÿ10000 FDUSDæŠ•èµ„å¯¹æ¯”
            let test_amount = 10000;
            
            // FDUSDæ± æ”¶ç›Š
            let fdusd_pool_newcoin = (test_amount / total_fdusd_staked) * fdusd_pool_total;
            let fdusd_pool_value = fdusd_pool_newcoin * p_newcoin;

            // BNBæ± æ”¶ç›Šï¼ˆå…ˆå°†FDUSDè½¬æ¢ä¸ºBNBï¼‰
            let equivalent_bnb = test_amount / bnb_price;
            let bnb_pool_newcoin = (equivalent_bnb / total_bnb_staked) * bnb_pool_total;
            let bnb_pool_value = bnb_pool_newcoin * p_newcoin;

            // æ›´æ–°æ˜¾ç¤ºç»“æœ
            document.getElementById('line_total_newcoin').innerHTML = `${total_newcoin_gained.toFixed(6)} NEWCOIN`;
            document.getElementById('line_newcoin_price').innerHTML = `${p_newcoin.toFixed(4)} FDUSD`;
            document.getElementById('line_total_value').innerHTML = `${total_value.toFixed(2)} FDUSD`;
            document.getElementById('line_fdusd_profit').innerHTML = `${fdusd_pool_value.toFixed(2)} FDUSD`;
            document.getElementById('line_bnb_profit').innerHTML = `${bnb_pool_value.toFixed(2)} FDUSD`;

            document.getElementById('results').style.display = 'block';
        }
    </script>
</body>
</html>
